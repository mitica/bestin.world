---
// ShareButton component for sharing the current page URL
---

<button
  id="share-button"
  class="fixed bottom-16 right-4 md:bottom-40 md:right-10 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all duration-200 hover:shadow-xl z-49"
  title="Share this page"
  aria-label="Share this page"
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="h-6 w-6"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
    stroke-width="2"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"
    ></path>
  </svg>
</button>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const shareButton = document.getElementById("share-button");

    if (shareButton) {
      shareButton.addEventListener("click", async function () {
        try {
          let url =
            document
              .querySelector('link[rel="canonical"]')
              ?.getAttribute("href") || window.location.href;
          // Check if the Web Share API is available
          if (navigator.share) {
            await navigator.share({
              title: document.title,
              text:
                document
                  .querySelector('meta[name="description"]')
                  ?.getAttribute("content") || "",
              url
            });
          } else {
            // Fallback: copy URL to clipboard
            await navigator.clipboard.writeText(url);

            // Show a temporary notification
            const originalTitle = shareButton.getAttribute("title");
            shareButton.setAttribute("title", "URL copied to clipboard!");
            shareButton.style.backgroundColor = "#10b981"; // green

            setTimeout(() => {
              shareButton.setAttribute(
                "title",
                originalTitle || "Share this page"
              );
              shareButton.style.backgroundColor = ""; // reset to CSS
            }, 2000);
          }
        } catch (error) {
          console.log("Sharing failed:", error);

          // Fallback: try to copy to clipboard
          try {
            await navigator.clipboard.writeText(window.location.href);
            const originalTitle = shareButton.getAttribute("title");
            shareButton.setAttribute("title", "URL copied to clipboard!");
            shareButton.style.backgroundColor = "#10b981"; // green

            setTimeout(() => {
              shareButton.setAttribute(
                "title",
                originalTitle || "Share this page"
              );
              shareButton.style.backgroundColor = ""; // reset to CSS
            }, 2000);
          } catch (clipboardError) {
            console.log("Clipboard access failed:", clipboardError);
          }
        }
        try {
          (window as any).sa_event("click_share_button");
        } catch (error) {
          console.error("Error tracking event:", error);
        }
      });
    }
  });
</script>
